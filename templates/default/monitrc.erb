set daemon <%= @node[:monit][:poll_period] %>
  with start delay <%= @node[:monit][:poll_start_delay] %>

<% unless @node[:monit][:logfile].nil? %>
set logfile <%= @node[:monit][:logfile] %>
<% end %>

set eventqueue
    basedir <%= @node[:monit][:queue][:location] %>  # set the base directory where events will be stored
    <% unless @node[:monit][:queue][:slots].nil? %>
    slots <%= @node[:monit][:queue][:slots] %> # optionally limit the queue size
    <% end %>

<% unless @node[:monit][:mail][:server].nil? %>
set mailserver <%= @node[:monit][:mail][:server] %>
    <%= "PORT #{@node[:monit][:mail][:port]}" unless not @node[:monit][:mail][:port] %>
    <% if @node[:monit][:mail][:username] && @node[:monit][:mail][:password] %>
    USERNAME <%= @node[:monit][:mail][:username] %> PASSWORD <%= @node[:monit][:mail][:password] %>
    <% end %>
    <%= "USING #{@node[:monit][:mail][:security]}" unless not @node[:monit][:mail][:security] %>
    <%= "CERTMD5 #{@node[:monit][:mail][:checksum]}" unless not @node[:monit][:mail][:security] %>
    <%= "with TIMEOUT #{@node[:monit][:mail][:timeout]} SECONDS" unless not @node[:monit][:mail][:timeout] %>
    <%= "using HOSTNAME #{@node.fqdn}" unless not @node[:monit][:mail][:use_node_fqdn] %>

set mail-format { 
  from: <%= @node[:monit][:mail][:format][:from] %>
  subject: <%= @node[:monit][:mail][:format][:subject] %>
  message: <%= @node[:monit][:mail][:format][:message] %>
}
<% end %>

<% if @node[:monit][:notify][:enable] %>
set alert <%= @node[:monit][:notify][:email] %> NOT ON { action, instance, pid, ppid }
<% end %>

<% if @node[:monit][:httpd][:enable] %>
set httpd port <%= @node[:monit][:httpd][:port] %> and
    <% unless @node[:monit][:httpd][:address].nil? %>
    use address <%= @node[:monit][:httpd][:address] %>
    <% end %>
    <% unless @node[:monit][:httpd][:allow].nil? %>
        <% @node[:monit][:httpd][:allow].each do |allow| %>
        allow <%= allow %>
        <% end %>
    <% end %>
    signature <%= @node[:monit][:httpd][:signature] %>
    <% @node[:monit][:httpd][:basic_auth_accounts].each do |auth| %>
    allow <%= auth %>
    <% end %>
<% end %>

include <%= @config_directory %>/*.conf
